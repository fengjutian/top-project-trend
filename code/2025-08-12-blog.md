---
slug: code1
title: jsæ—¥å¿—
authors: fengjutian
tags: []
---
### jsæ—¥å¿—

```javascript
type LoggerConfigType = {
  // å‘½åç©ºé—´
  namespace?: string
}

/**
 * æ‹¦æˆªå™¨å‡½æ•°ç±»å‹
 */
type InterceptorFuncType = (config: LoggerConfigType) => void

const enum LogLevel {
  Log, // æ™®é€šæ—¥å¿—
  Warning, // è­¦å‘Šæ—¥å¿—
  Error, // é”™è¯¯æ—¥å¿—
}

const __DEV__ = import.meta.env.MODE
const Styles = ['color: green;', 'color: orange;', 'color: red;']
const Methods = ['info', 'warn', 'error'] as const

class Logger {
  /** å‘½åç©ºé—´ï¼ˆscopeï¼‰ï¼Œç”¨äºåŒºåˆ†æ‰€åœ¨æ‰§è¡Œæ–‡ä»¶ */
  private beforeFuns: Array<InterceptorFuncType> = []
  private afterFuns: Array<InterceptorFuncType> = []
  private config: LoggerConfigType = {}

  constructor(namespace = 'unknown') {
    this.config.namespace = `[${namespace}]`
  }
  /**
   * åˆ›å»ºæ–°çš„ Logger å®ä¾‹
   * 
   * @param namespace å‘½åç©ºé—´
   * @returns Logger
   */
  public create(namespace = 'unknown') {
    return new Logger(namespace);
  }

  private _log(level: LogLevel, args: unknown[]) {
    if (__DEV__ !== 'development') return
    this.beforeFuns.forEach(func => func(this.config))
    console[Methods[level]](`%c${this.config.namespace}`, Styles[level], ...args)
  }

  private addInterceptor(func: InterceptorFuncType, isBefore = true) {
    if(typeof func !== 'function'){
      return this.error('æ‹¦æˆªå™¨å‡½æ•°ä¸ç¬¦åˆè§„èŒƒ')
    }

    if(isBefore){
      this.beforeFuns.push(func)
    }

    this.afterFuns.push(func)
    return this
  }

  // æ—¥å¿—æ‰“å°ä¹‹å‰çš„æ‹¦æˆªå™¨å‚æ•°
  public addBeforeFunc(func: InterceptorFuncType) {
    this.addInterceptor(func)
    return this
  }

  // æ—¥å¿—æ‰“å°ä¹‹åçš„æ‹¦æˆªå‡½æ•°
  public addAfterFunc(func: InterceptorFuncType) {
    this.addInterceptor(func, false)
    return this
  }

  /**
   * æ‰“å°è¾“å‡ºä¿¡æ¯ ğŸ›
   *
   * @param args ä»»æ„å‚æ•°
   */
  public info(...args: unknown[]) {
    this._log(LogLevel.Log, args)
    return this
  }

  /**
   * æ‰“å°è¾“å‡ºè­¦å‘Šä¿¡æ¯ â•
   *
   * @param args ä»»æ„å‚æ•°
   */
  public warn(...args: unknown[]) {
    this._log(LogLevel.Warning, args)
    return this
  }

  /**
   * æ‰“å°è¾“å‡ºé”™è¯¯ä¿¡æ¯ âŒ
   *
   * @param args ä»»æ„å‚æ•°
   */
  public error(...args: unknown[]) {
    this._log(LogLevel.Error, args)
    return this
  }

  /**
   * è®¾ç½®å‘½åç©ºé—´ï¼ˆæ—¥å¿—å‰ç¼€ï¼‰
   * @param namespace
   */
  public setNamespace(namespace = '') {
    this.config.namespace = `[${namespace}]`
    return this
  }

  /**
   * è¿œç¨‹ä¸ŠæŠ¥
   */
  public reportLog() {
    this.info() // ç”¨äºåœ¨æœ¬åœ°è¾“å‡º
  }
  public reportEvent() {
    this.info()
  }
  public reportException() {
    this.error()
  }
}

export default new Logger()
```





